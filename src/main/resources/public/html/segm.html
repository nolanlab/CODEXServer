<!DOCTYPE html>
<html lang="en">
<style>
#myProgress {
  width: 100%;
  background-color: #ddd;
}

#myBar {
  width: 1%;
  height: 30px;
  background-color: #3e79ad;
}
</style>
<head>
    <meta charset="UTF-8">
    <title>Run Segmentation</title>
    <link rel="shortcut icon" href="/images/codexlogo.ico" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


</head>
<body>

<div class="container" style="width:600px;">
    <h2 align="center">Segmentation Details</h2><br />

    <form id ="segm" method="POST" action="http://localhost:4567/runSegm" onsubmit="showProgress()">

        <div class="form-group">
            <label for="user">Select User:</label>
            <select name="user" id="user" class="form-control input" placeholder="Choose user" required>
                <option value="">Choose user</option>
            </select>
        </div>

        <div class="form-group">
            <label for="exp">Enter experiment name:</label>
            <select name="exp" id="exp" class="form-control input" placeholder="Choose experiment" required>
                <option value="">Choose experiment</option>
            </select>
        </div>

        <div class="form-group">
            <label for="radius">Radius:</label>
            <input type="number" class="form-control" ng-model="radius" value="5" id="radius" placeholder="Enter radius" name="radius" required>
        </div>

        <div class="form-group">
            <label for="maxCutOff">Max Cutoff:</label>
            <input type="number" class="form-control" ng-model="maxCutOff" value="0.99" step="0.01" id="maxCutOff" placeholder="Enter Max CutOff" name="maxCutOff" required>
        </div>

        <div class="form-group">
            <label for="minCutOff">Min Cutoff:</label>
            <input type="number" class="form-control" ng-model="minCutOff" value="0.05" step="0.01" id="minCutOff" placeholder="Enter Min CutOff" name="minCutOff" required>
        </div>

        <div class="form-group">
            <label for="relativeCutOff">Relative Cutoff:</label>
            <input type="number" class="form-control" ng-model="relativeCutOff" value="0.2" step="0.1" id="relativeCutOff" placeholder="Enter Relative CutOff" name="relativeCutOff" required>
        </div>

        <div class="form-group">
            <label for="nucStainChannel">Nuclear Stain Channel:</label>
            <input type="number" class="form-control" ng-model="nucStainChannel" value="1" id="nucStainChannel" placeholder="Enter Nuclear Stain Channel" name="nucStainChannel" required>
        </div>

        <div class="form-group">
            <label for="nucStainCycle">Nuclear Stain Cycle:</label>
            <input type="number" class="form-control" ng-model="nucStainCycle" value="1" id="nucStainCycle" placeholder="Enter Nuclear Stain Cycle" name="nucStainCycle" required>
        </div>

        <div class="form-group">
            <label for="membStainChannel">Membrane Stain Channel:</label>
            <input type="number" class="form-control" ng-model="membStainChannel" value="1" id="membStainChannel" placeholder="Enter Membrane Stain Channel" name="membStainChannel" required>
        </div>

        <div class="form-group">
            <label for="membStainCycle">Membrane Stain Cycle:</label>
            <input type="number" class="form-control" ng-model="membStainCycle" value="-1" id="membStainCycle" placeholder="Enter Membrane Stain Cycle" name="membStainCycle" required>
        </div>

        <div class="form-group" >
            <input type="submit" id="submit" value="Start segmentation" class="btn btn-primary btn-lg" data-loading-text="Running segmentation" />
            <script type="text/javascript">
                $('#segm').submit(function() {
                    var $this = $('#submit');
                    $this.button('loading');
                    setTimeout(function() {
                        $this.button('reset');
                    }, 20000);
                });
            </script>
        </div>

        <div class="progress">
            <div id = "pro" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                <font color="black"> 0% segmented </font>
            </div>
        </div>


        <script type="text/javascript">
            function showProgress() {
                setInterval(function(){
                    jQuery.ajax({
                        type: "GET",
                        url: "/getProgress",
                        success: function(result) {
                            $('#pro').css("width", result + '%');
                            $('#pro').html(result + "% segmented");
                        },
                    });
                }, 5000);
            }
        </script>
    </form>
</div>
</body>


<script type="text/javascript" language="javascript">
        $().ready(function() {
            $.ajax({
                type: "GET",
                url: "/getUserList",
                contentType: "application/json",
                dataType: "json",
                success: function(msg) {
                    $("#user").get(0).options.length = 0;
                    $("#user").get(0).options[0] = new Option("Choose user", "-1");
                    $.each(msg, function(i,obj)
                    {
                        var div_data="<option value="+obj+">"+obj+"</option>";
                        $(div_data).appendTo('#user');
                    });
                    $("#user").bind("change", function() {
                        GetExperiments($(this).val());
                    });
                },
                error: function() {
                    alert("Failed to load users");
                }
            });
        });
        function GetExperiments(user) {
            if(user != -1) {
                $("#exp").get(0).options.length = 0;
                $.ajax({
                    type: "GET",
                    url: "/getExperimentList?user="+user,
                    contentType: "application/json",
                    dataType: "json",
                    success: function(msg) {
                        $("#exp").get(0).options.length = 0;
                        $("#exp").get(0).options[0] = new Option("Choose experiment", "-1");
                    $.each(msg, function(i,obj)
                    {
                        var div_data="<option value="+obj+">"+obj+"</option>";
                        $(div_data).appendTo('#exp');
                    });
                    }
                });
            }
            else {
                $("#exp").get(0).options.length = 0;
                $("#exp").get(0).options[0] = new Option("Choose experiment", "-1");
            }
        }
    </script>
</html>